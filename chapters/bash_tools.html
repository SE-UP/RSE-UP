

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Building Tools with the Unix Shell &#8212; RSE-ING</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/bash_tools';</script>
    <link rel="canonical" href="https://software-engineering-group-up.github.io/RSE-UP/chapters/bash_tools.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Going Further with the Unix Shell" href="bash_advanced.html" />
    <link rel="prev" title="The Basics of the Unix Shell" href="bash_basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="welcome.html">
  
  
  
  
  
  
    <p class="title logo__title">RSE-ING</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bash and the CLI</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="bash_basics.html">The Basics of the Unix Shell</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Building Tools with the Unix Shell</a></li>

<li class="toctree-l1"><a class="reference internal" href="bash_advanced.html">Going Further with the Unix Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/bash.html">Bash Exercises</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Building CLI with Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="python_building_cli.html">Building Command-Line Tools with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/python_cli.html">Exercises - Scripting Python for CLI tools</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Version Control</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro_version_control.html">Using Git at the Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/version_control.html">Exercise Version Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_advanced.html">Going Further with Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/git_advanced.html">Exercises Git Advanced</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Working in teams</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="working_in_teams.html">Working in Teams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/work_teams.html">Exercise - Work Teams</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to automation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro_make.html">Automating Analyses with Make</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/intro_make.html">Exercises - Make</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Configuration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuring Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/config.html">Exercises - Configuration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Testing Software</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="testing_programs.html">Testing Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/testing.html">Exercises - Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Error Handling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="error_handling.html">Handling Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/error_handling.html">Exercises - Error Handling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tracking Provenance</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tracking_provenance.html">Tracking Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/provenance.html">Exercises - Provenance</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Packaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="python_packaging.html">Creating Packages with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/packaging.html">Exercises - Packaging</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Writing Clean Code</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="clean_readable_code.html">Writing Readable Code</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="writing_documentation.html">Documenting Programs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Workflows</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Introduction to Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="snakemake.html">Snake Make</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_cicd.html">CI/CD</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Worksheets - Course Work</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../worksheets/worksheet2_install_more_tool_shell.html">Worksheet 2 - Installing more Tools, working with the Unix SHell, Getting Started with the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../worksheets/worksheet3_cli_python_git.html">Worksheet 3 - Command Line Tools with Python , Git and the Command Line, Git UP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../worksheets/worksheet4_readable_code.html">Worksheet 4 - Readable Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../worksheets/worksheet6_software_license.html">Worksheet 6 - Software Licensing, Citation and FAIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../worksheets/worksheet7_git_advanced.html">Worksheet 8 - Going further with Git</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">First Project - Invdividual</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projects/individual/1_project_instructions.html">Project Assignment 1: Select a Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/individual/2_project_instructions.html">Project Assignment 2: Setting Up the Repository on Git.UP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/individual/3_project_instructions.html">Project Assignment 4: Start Coding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/individual/4_project_instructions.html">Project Assignment 4: More Code, a Notebook, and a README.md</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/individual/5_project_instructions.html">Project Assignment 5: Add License and Citation Informatoon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/individual/6_project_instructions.html">Project Assignment 6:</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Second Project - Group</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projects/group/1_project_assignment.html">Project Assignment: Form Groups for Second Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/group/2_project_assignment.html">Project Assignment 2: Name, Idea and Basic Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/group/3_project_assignment.html">Project Assignment 3: Requirements, Architecture, Design and Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/group/4_project_assignment.html">Project Assignment 4: Testing and Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/group/5_project_assignment.html">Project Assignment 5: Program Configuration, Packaging and Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/group/6_project_assignment.html">Project Assignment 6: Finish and Submit the Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="solutions.html">Solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="anaconda.html">Anaconda</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml.html">YAML</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_remotely.html">Working Remotely</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Software-Engineering-Group-UP/RSE-UP" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Software-Engineering-Group-UP/RSE-UP/issues/new?title=Issue%20on%20page%20%2Fchapters/bash_tools.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/bash_tools.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Building Tools with the Unix Shell</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Building Tools with the Unix Shell</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-commands">Combining Commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-pipes-work">How Pipes Work</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repeating-commands-on-many-files">Repeating Commands on Many Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variable-names">Variable Names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redoing-things">Redoing Things</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-filenames-automatically">Creating New Filenames Automatically</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-does-mean">What does <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> mean?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#appending-data">Appending data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#piping-commands">Piping commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-uniq-only-remove-adjacent-duplicates">Why does <code class="docutils literal notranslate"><span class="pre">uniq</span></code> only remove adjacent duplicates?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipe-reading-comprehension">Pipe reading comprehension</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipe-construction">Pipe construction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#which-pipe">Which pipe?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#doing-a-dry-run">Doing a dry run</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variables-in-loops">Variables in loops</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#limiting-sets-of-files">Limiting sets of files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-to-a-file-in-a-loop">Saving to a file in a loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-history-record-commands-before-running-them">Why does <code class="docutils literal notranslate"><span class="pre">history</span></code> record commands before running them?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-points">Key Points</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Building Tools with the Unix Shell</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Combining Commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">How Pipes Work</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Repeating Commands on Many Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Variable Names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Redoing Things</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Creating New Filenames Automatically</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Key Points</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="building-tools-with-the-unix-shell">
<h1>Building Tools with the Unix Shell<a class="headerlink" href="#building-tools-with-the-unix-shell" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p>Wisdom comes from experience. Experience is often a result of lack of wisdom.</p>
<p>— Terry Pratchett</p>
</div></blockquote>
<p>The shell’s greatest strength is that
it lets us combine programs to create pipelines
that can handle large volumes of data.
This lesson shows how to do that,
and how to repeat commands to process as many files as we want automatically.</p>
<p>We’ll be continuing to work in the <code class="docutils literal notranslate"><span class="pre">zipf</span></code> project,
which should contain the following files after the previous chapter:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>zipf/
└── data
    ├── README.md
    ├── dracula.txt
    ├── frankenstein.txt
    ├── jane_eyre.txt
    ├── moby_dick.txt
    ├── sense_and_sensibility.txt
    ├── sherlock_holmes.txt
    └── time_machine.txt
</pre></div>
</div>
<section id="combining-commands">
<h2>Combining Commands<a class="headerlink" href="#combining-commands" title="Permalink to this heading">#</a></h2>
<p>To see how the shell lets us combine commands, let’s go into the <code class="docutils literal notranslate"><span class="pre">zipf/data</span></code> directory and count the number of lines in each file once again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/zipf/data
$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  15975 dracula.txt
   7832 frankenstein.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
   3582 time_machine.txt
  96855 total
</pre></div>
</div>
<p>Which of these books is shortest?
We can check by eye when there are only seven files, but what if there were eight thousand?</p>
<p>Our first step toward a solution is to run this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span>&gt;<span class="w"> </span>lengths.txt
</pre></div>
</div>
<p>The greater-than symbol <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> tells the shell
to <strong>redirect</strong> the command’s output to a file instead of printing it.
Nothing appears on the screen; instead, everything that would have appeared has gone into the file <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code>. The shell creates this file if it doesn’t exist, or overwrites it if it already exists.</p>
<p>We can print the contents of <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code> using <code class="docutils literal notranslate"><span class="pre">cat</span></code>, which is short for con<strong>cat</strong>enate (because if we give it the names of several files
it will print them all in order):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>lengths.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  15975 dracula.txt
   7832 frankenstein.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
   3582 time_machine.txt
  96855 total
</pre></div>
</div>
<p>We can now use <code class="docutils literal notranslate"><span class="pre">sort</span></code> to sort the lines in this file:</p>
<p>\newpage</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span>lengths.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
  15975 dracula.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  96855 total
</pre></div>
</div>
<p>Just to be safe,
we use <code class="docutils literal notranslate"><span class="pre">sort</span></code>’s <code class="docutils literal notranslate"><span class="pre">-n</span></code> option to specify that we want to sort numerically.
Without it,
<code class="docutils literal notranslate"><span class="pre">sort</span></code> would order things alphabetically
so that <code class="docutils literal notranslate"><span class="pre">10</span></code> would come before <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">sort</span></code> does not change <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code>.
Instead,
it sends its output to the screen just as <code class="docutils literal notranslate"><span class="pre">wc</span></code> did.
We can therefore put the sorted list of lines in another temporary file called <code class="docutils literal notranslate"><span class="pre">sorted-lengths.txt</span></code>
using <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> once again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span>lengths.txt<span class="w"> </span>&gt;<span class="w"> </span>sorted-lengths.txt
</pre></div>
</div>
<blockquote>
<div><p><strong>Redirecting to the Same File</strong></p>
<p>It’s tempting to send the output of <code class="docutils literal notranslate"><span class="pre">sort</span></code> back to the file it reads:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span>lengths.txt<span class="w"> </span>&gt;<span class="w"> </span>lengths.txt
</pre></div>
</div>
<p>However, all this does is wipe out the contents of <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code>.
The reason is that when the shell sees the redirection,
it opens the file on the right of the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> for writing,
which erases anything that file contained.
It then runs <code class="docutils literal notranslate"><span class="pre">sort</span></code>, which finds itself reading from a newly empty file.</p>
</div></blockquote>
<p>Creating intermediate files with names like <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">sorted-lengths.txt</span></code> works,
but keeping track of those files and cleaning them up when they’re no longer needed is a burden.
Let’s delete the two files we just created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>lengths.txt<span class="w"> </span>sorted-lengths.txt
</pre></div>
</div>
<p>We can produce the same result more safely and with less typing
using a <strong>pip</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
  15975 dracula.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  96855 total
</pre></div>
</div>
<p>The vertical bar <code class="docutils literal notranslate"><span class="pre">|</span></code> between the <code class="docutils literal notranslate"><span class="pre">wc</span></code> and <code class="docutils literal notranslate"><span class="pre">sort</span></code> commands
tells the shell that we want to use the output of the command on the left
as the input to the command on the right.</p>
<p>Running a command with a file as input has a clear flow of information:
the command performs a task on that file and prints the output to the screen
(<span class="xref myst"></span> a).
When using pipes, however,
the information flows differently after the first (upstream) command.
The downstream command doesn’t read from a file.
Instead,
it reads the output of the upstream command
(<span class="xref myst"></span> b).</p>
<figure class="align-default" id="bash-toots-piper">
<img alt="../_images/pipe.png" src="../_images/pipe.png" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Bash tool pipe</span><a class="headerlink" href="#bash-toots-piper" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We can use <code class="docutils literal notranslate"><span class="pre">|</span></code> to build pipes of any length.
For example, we can use the command <code class="docutils literal notranslate"><span class="pre">head</span></code> to get just the first three lines of sorted data,which shows us the three shortest books:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
</pre></div>
</div>
<blockquote>
<div><p><strong>Options Can Have Values</strong></p>
<p>When we write <code class="docutils literal notranslate"><span class="pre">head</span> <span class="pre">-n</span> <span class="pre">3</span></code>,
the value 3 is not input to <code class="docutils literal notranslate"><span class="pre">head</span></code>.
Instead, it is associated with the option <code class="docutils literal notranslate"><span class="pre">-n</span></code>.
Many options take values like this,
such as the names of input files or the background color to use in a plot.
Some versions of <code class="docutils literal notranslate"><span class="pre">head</span></code> may allow you to use <code class="docutils literal notranslate"><span class="pre">head</span> <span class="pre">-3</span></code> as a shortcut,
though this can be confusing if other options are included.</p>
</div></blockquote>
<p>We could always redirect the output to a file
by adding <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">shortest.txt</span></code> to the end of the pipeline,
thereby retaining our answer for later reference.</p>
<p>In practice,
most Unix users would create this pipeline step by step,
just as we have:
by starting with a single command and adding others one by one,
checking the output after each change.
The shell makes this easy
by letting us move up and down in our <strong>command history</strong>
with the <kbd>↑</kbd> and <kbd>↓</kbd> keys.
We can also edit old commands to create new ones,
so a very common sequence is:</p>
<ul class="simple">
<li><p>Run a command and check its output.</p></li>
<li><p>Use <kbd>↑</kbd> to bring it up again.</p></li>
<li><p>Add the pipe symbol <code class="docutils literal notranslate"><span class="pre">|</span></code> and another command to the end of the line.</p></li>
<li><p>Run the pipe and check its output.</p></li>
<li><p>Use <kbd>↑</kbd> to bring it up again.</p></li>
<li><p>And so on.</p></li>
</ul>
</section>
<section id="how-pipes-work">
<h2>How Pipes Work<a class="headerlink" href="#how-pipes-work" title="Permalink to this heading">#</a></h2>
<p>In order to use pipes and redirection effectively,
we need to know a little about how they work.
When a computer runs a program—any program—it creates a <strong>process</strong>
to hold the program’s instructions and data.
Every process in Unix has an input channel called <strong>stdin</strong> - <strong>standard input</strong> and an output channel called <strong>standard output</strong> - <strong>stdout</strong>
(By now you may be surprised that their names are so memorable,
but don’t worry: most Unix programmers call them “stdin” and “stdout”,
which are pronounced “stuh-Din” and “stuh-Dout”).</p>
<p>The shell is a program like any other,
and like any other,
it runs inside a process.
Under normal circumstances its standard input is connected to our keyboard
and its standard output to our screen,
so it reads what we type
and displays its output for us to see (<a class="reference internal" href="#standard-io"><span class="std std-ref">Bash tools stdio</span></a> a).
When we tell the shell to run a program,
it creates a new process
and temporarily reconnects the keyboard and stream
to that process’s standard input and output (<a class="reference internal" href="#standard-io"><span class="std std-ref">Bash tools stdio</span></a> b).</p>
<figure class="align-default" id="standard-io">
<img alt="../_images/standard-io.png" src="../_images/standard-io.png" />
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Bash tools stdio</span><a class="headerlink" href="#standard-io" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If we provide one or more files for the command to read,
as with <code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">lengths.txt</span></code>,
the program reads data from those files.
If we don’t provide any filenames,
though,
the Unix convention is for the program to read from standard input.
We can test this by running <code class="docutils literal notranslate"><span class="pre">sort</span></code> on its own,
typing in a few lines of text,
and then pressing <kbd>Ctrl</kbd>+<kbd>D</kbd> to signal the end of input .
<code class="docutils literal notranslate"><span class="pre">sort</span></code> will then sort and print whatever we typed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort
one
two
three
four
^D
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>four
one
three
two
</pre></div>
</div>
<p>Redirection with <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> tells the shell to connect the program’s standard output to a file
instead of the screen (<span class="xref myst"></span>c).</p>
<p>When we create a pipe like <code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">*.txt</span> <span class="pre">|</span> <span class="pre">sort</span></code>,
the shell creates one process for each command so that <code class="docutils literal notranslate"><span class="pre">wc</span></code> and <code class="docutils literal notranslate"><span class="pre">sort</span></code> will run simultaneously,
and then connects the standard output of <code class="docutils literal notranslate"><span class="pre">wc</span></code> directly to the standard input of <code class="docutils literal notranslate"><span class="pre">sort</span></code>
(<span class="xref myst"></span>d).</p>
<p><code class="docutils literal notranslate"><span class="pre">wc</span></code> doesn’t know whether its output is going to the screen,
another program,
or to a file via <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>.
Equally,
<code class="docutils literal notranslate"><span class="pre">sort</span></code> doesn’t know if its input is coming from the keyboard or another process;
it just knows that it has to read, sort, and print.</p>
<blockquote>
<div><p><strong>Why Isn’t It Doing Anything?</strong></p>
<p>What happens if a command is supposed to process a file
but we don’t give it a filename?
For example, what if we type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l
</pre></div>
</div>
<p>but don’t type <code class="docutils literal notranslate"><span class="pre">*.txt</span></code> (or anything else) after the command?
Since <code class="docutils literal notranslate"><span class="pre">wc</span></code> doesn’t have any filenames,
it assumes it is supposed to read from the keyboard,
so it waits for us to type in some data.
It doesn’t tell us this;
it just sits and waits.</p>
<p>This mistake can be hard to spot,
particularly if we put the filename at the end of the pipeline:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>moby_dick.txt
</pre></div>
</div>
<p>In this case,
<code class="docutils literal notranslate"><span class="pre">sort</span></code> ignores standard input and reads the data in the file,
but <code class="docutils literal notranslate"><span class="pre">wc</span></code> still just sits there waiting for input.</p>
<p>If we make this mistake,
we can end the program by typing <kbd>Ctrl</kbd>+<kbd>C</kbd>.
We can also use this to interrupt programs that are taking a long time to run
or are trying to connect to a website that isn’t responding.</p>
</div></blockquote>
<p>\newpage</p>
<p>Just as we can redirect standard output with <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>,
we can connect standard input to a file using <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>.\index{redirection (in Unix shell)}
In the case of a single file,
this has the same effect as providing the file’s name to the <code class="docutils literal notranslate"><span class="pre">wc</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>&lt;<span class="w"> </span>moby_dick.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>    22331  215832 1276222
</pre></div>
</div>
<p>If we try to use redirection with a wildcard,
though,
the shell <em>doesn’t</em> concatenate all of the matching files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>&lt;<span class="w"> </span>*.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-bash: *.txt: ambiguous redirect
</pre></div>
</div>
<p>It also doesn’t print the error message to standard output,
which we can prove by redirecting:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>&lt;<span class="w"> </span>*.txt<span class="w"> </span>&gt;<span class="w"> </span>all.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-bash: *.txt: ambiguous redirect
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>all.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cat: all.txt: No such file or directory
</pre></div>
</div>
<p>Instead,
every process has a second output channel called <strong>standard error</strong> Programs use it for error messages so that their attempts to tell us something has gone wrong don’t vanish silently into an output file.
There are ways to redirect standard error, but doing so is almost always a bad idea.</p>
</section>
<section id="repeating-commands-on-many-files">
<h2>Repeating Commands on Many Files<a class="headerlink" href="#repeating-commands-on-many-files" title="Permalink to this heading">#</a></h2>
<p>A loop is a way to repeat a set of commands for each item in a list.
We can use them to build complex workflows out of simple pieces, and (like wildcards) they reduce the typing we have to do and the number of mistakes we might make.</p>
<p>Let’s suppose that we want to take a section out of each book
whose name starts with the letter “s” in the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory.
More specifically,
suppose we want to get the first 8 lines of each book
<em>after</em> the 9 lines of license information that appear at the start of the file.
If we only cared about one file,
we could write a pipeline to take the first 17 lines
and then take the last 8 of those:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span>sense_and_sensibility.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English
</pre></div>
</div>
<p>If we try to use a wildcard to select files,
we only get 8 lines of output,
not the 16 we expect:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w">  </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span>s*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
<p>The problem is that <code class="docutils literal notranslate"><span class="pre">head</span></code> is producing a single stream of output
containing 17 lines for each file
(along with a header telling us the file’s name):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span>s*.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>==&gt; sense_and_sensibility.txt &lt;==
The Project Gutenberg EBook of Sense and Sensibility, by ...

This eBook is for the use of anyone anywhere at no cost and with
almost no restrictions whatsoever.  You may copy it, give it ...
re-use it under the terms of the Project Gutenberg License ...
with this eBook or online at www.gutenberg.net



Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English

==&gt; sherlock_holmes.txt &lt;==
Project Gutenberg&#39;s The Adventures of Sherlock Holmes, by Arthur
Conan Doyle

This eBook is for the use of anyone anywhere at no cost and ...
almost no restrictions whatsoever.  You may copy it, give ...
re-use it under the terms of the Project Gutenberg License ...
with this eBook or online at www.gutenberg.net



Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
<p>Let’s try this instead:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>sense_and_sensibility.txt<span class="w"> </span>sherlock_holmes.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English
Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
<p>As the output shows,
the loop runs our pipeline once for each file.
There is a lot going on here,
so we will break it down into pieces:</p>
<ol class="arabic simple">
<li><p>The keywords <code class="docutils literal notranslate"><span class="pre">for</span></code>, <code class="docutils literal notranslate"><span class="pre">in</span></code>, <code class="docutils literal notranslate"><span class="pre">do</span></code>, and <code class="docutils literal notranslate"><span class="pre">done</span></code> create the loop,
and must always appear in that order.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code> is a variable just like a variable in Python.
At any moment it contains a value,
but that value can change over time.</p></li>
<li><p>The loop runs once for each item in the list.
Each time it runs,
it assigns the next item to the variable.
In this case, <code class="docutils literal notranslate"><span class="pre">filename</span></code> will be <code class="docutils literal notranslate"><span class="pre">sense_and_sensibility.txt</span></code>
the first time around the loop
and <code class="docutils literal notranslate"><span class="pre">sherlock_holmes.txt</span></code> the second time.</p></li>
<li><p>The commands that the loop executes are called the <strong>body</strong> and
appear between the keywords <code class="docutils literal notranslate"><span class="pre">do</span></code> and <code class="docutils literal notranslate"><span class="pre">done</span></code>.
Those commands use the current value of the variable <code class="docutils literal notranslate"><span class="pre">filename</span></code>,
but to get it,
we must put a dollar sign <code class="docutils literal notranslate"><span class="pre">$</span></code> in front of the variable’s name.
If we forget and use <code class="docutils literal notranslate"><span class="pre">filename</span></code> instead of <code class="docutils literal notranslate"><span class="pre">$filename</span></code>,
the shell will think that we are referring to a file
that is actually called <code class="docutils literal notranslate"><span class="pre">filename</span></code>.</p></li>
<li><p>The shell prompt changes from <code class="docutils literal notranslate"><span class="pre">$</span></code>
to a <strong>continuation prompt</strong> <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> as we type in our loop.
to remind us that we haven’t finished typing a complete command yet.
We don’t type the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>,
just as we don’t type the <code class="docutils literal notranslate"><span class="pre">$</span></code>.
The continuation prompt <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> has nothing to do with redirection;
it’s used because there are only so many punctuation symbols available.</p></li>
</ol>
<blockquote>
<div><p><strong>Continuation Prompts May Differ Too</strong></p>
<p>As mentioned in Chapter <a class="reference external" href="https://software-engineering-group-up.github.io/RSE-UP/chapters/bash_basics.html">Bash Basics</a>
),
there is variation in how different shells look and operate.
If you noticed the second, third, and fourth code lines
in your for loop were prefaced with <code class="docutils literal notranslate"><span class="pre">for</span></code>,
it’s not because you did something wrong!
That difference is one of the ways in which <code class="docutils literal notranslate"><span class="pre">zsh</span></code> differs from <code class="docutils literal notranslate"><span class="pre">bash</span></code>.</p>
</div></blockquote>
<p>It is very common to use a wildcard to select a set of files
and then loop over that set to run commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English



Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
</section>
<section id="variable-names">
<h2>Variable Names<a class="headerlink" href="#variable-names" title="Permalink to this heading">#</a></h2>
<p>We should always choose meaningful names for variables,
but we should remember that those names don’t mean anything to the computer.
For example,we have called our loop variable <code class="docutils literal notranslate"><span class="pre">filename</span></code>
to make its purpose clear to human readers, but we could equally well write our loop as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$x</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>or as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>username<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$username</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p><em>Don’t do this.</em>
Programs are only useful if people can understand them,
so meaningless names like <code class="docutils literal notranslate"><span class="pre">x</span></code> and misleading names like <code class="docutils literal notranslate"><span class="pre">username</span></code>
increase the odds of misunderstanding.</p>
</section>
<section id="redoing-things">
<h2>Redoing Things<a class="headerlink" href="#redoing-things" title="Permalink to this heading">#</a></h2>
<p>Loops are useful if we know in advance what we want to repeat,
but we can also repeat commands that we have run recently.
One way is to use <kbd>↑</kbd> and <kbd>↓</kbd>
to go up and down in our command history as described earlier.
Another is to use <code class="docutils literal notranslate"><span class="pre">history</span></code> to get a list of the last few hundred commands we have run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">history</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  551  wc -l *.txt | sort -n
  552  wc -l *.txt | sort -n | head -n 3
  553  wc -l *.txt | sort -n | head -n 1 &gt; shortest.txt
</pre></div>
</div>
<p>We can use an exclamation mark <code class="docutils literal notranslate"><span class="pre">!</span></code> followed by a number
to repeat a recent command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>!552
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
</pre></div>
</div>
<p>The shell prints the command it is going to re-run to standard error
before executing it,
so that (for example) <code class="docutils literal notranslate"><span class="pre">!572 &gt; results.txt</span></code>
puts the command’s output in a file
<em>without</em> also writing the command to the file.</p>
<p>Having an accurate record of the things we have done
and a simple way to repeat them
are two of the main reasons people use the Unix shell.
In fact,
being able to repeat history is such a powerful idea
that the shell gives us several ways to do it:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">!head</span></code> re-runs the most recent command starting with <code class="docutils literal notranslate"><span class="pre">head</span></code>,
while <code class="docutils literal notranslate"><span class="pre">!wc</span></code> re-runs the most recent starting with <code class="docutils literal notranslate"><span class="pre">wc</span></code>.</p></li>
<li><p>If we type <kbd>Ctrl</kbd>+<kbd>R</kbd> (for <strong>r</strong>everse search)
the shell searches backward through its history for whatever we type next.
If we don’t like the first thing it finds,
we can type <kbd>Ctrl</kbd>+<kbd>R</kbd> again to go further back.</p></li>
</ul>
<p>If we use <code class="docutils literal notranslate"><span class="pre">history</span></code>, <kbd>↑</kbd>, or <kbd>Ctrl</kbd>+<kbd>R</kbd>
we will quickly notice that loops don’t have to be broken across lines.
Instead,
their parts can be separated with semi-colons:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="p">;</span>
<span class="k">done</span>
</pre></div>
</div>
<p>This is fairly readable,
though it becomes more challenging if our for loop includes multiple commands.
For example,
we may choose to include the <code class="docutils literal notranslate"><span class="pre">echo</span></code> command,
which prints its arguments to the screen,
so we can keep track of progress or for debugging.
Compare this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$filename</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>with this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$filename</span><span class="p">;</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Even experienced users have a tendency to (incorrectly)
put the semi-colon after <code class="docutils literal notranslate"><span class="pre">do</span></code> instead of before it.
If our loop contains multiple commands,
though,
the multi-line format is much easier to read and troubleshoot.
Note that (depending on the size of your shell window)
the format separated by semi-colons may be printed onto more than one line,
as shown in the previous code example.
You can tell whether code entered into your shell
is intended to be run as a single line based on the prompt:
both the original command prompt (<code class="docutils literal notranslate"><span class="pre">$</span></code>) and the continuation prompt (<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>)
indicate the code is on separate lines;
the absence of either in shell commands indicates it is a single line of code.</p>
</section>
<section id="creating-new-filenames-automatically">
<h2>Creating New Filenames Automatically<a class="headerlink" href="#creating-new-filenames-automatically" title="Permalink to this heading">#</a></h2>
<p>Suppose we want to create a backup copy of each book whose name ends in “e”.
If we don’t want to change the files’ names,
we can do this with <code class="docutils literal notranslate"><span class="pre">cp</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/zipf
$<span class="w"> </span>mkdir<span class="w"> </span>backup
$<span class="w"> </span>cp<span class="w"> </span>data/*e.txt<span class="w"> </span>backup
$<span class="w"> </span>ls<span class="w"> </span>backup
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>jane_eyre.txt  time_machine.txt
</pre></div>
</div>
<blockquote>
<div><p><strong>Warnings</strong></p>
<p>If you attempt to re-execute the code chunk above,
you’ll end up with an error after the second line:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mkdir: backup: File exists
</pre></div>
</div>
<p>This warning isn’t necessarily a cause for alarm.
It lets you know that the command couldn’t be completed,
but will not prevent you from proceeding.</p>
</div></blockquote>
<p>But what if we want to append the extension <code class="docutils literal notranslate"><span class="pre">.bak</span></code> to the files’ names?
<code class="docutils literal notranslate"><span class="pre">cp</span></code> can do this for a single file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>data/time_machine.txt<span class="w"> </span>backup/time_machine.txt.bak
</pre></div>
</div>
<p>but not for all the files at once:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>data/*e.txt<span class="w"> </span>backup/*e.txt.bak
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp: target &#39;backup/*e.txt.bak&#39; is not a directory
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">backup/*e.txt.bak</span></code> doesn’t match anything—those files don’t yet exist—so
after the shell expands the <code class="docutils literal notranslate"><span class="pre">*</span></code> wildcards,
what we are actually asking <code class="docutils literal notranslate"><span class="pre">cp</span></code> to do is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>data/jane_eyre.txt<span class="w"> </span>data/time_machine.txt<span class="w"> </span>backup/*e.bak
</pre></div>
</div>
<p>This doesn’t work because <code class="docutils literal notranslate"><span class="pre">cp</span></code> only understands how to do two things:
copy a single file to create another file,
or copy a bunch of files into a directory.
If we give it more than two names as arguments,
it expects the last one to be a directory.
Since <code class="docutils literal notranslate"><span class="pre">backup/*e.bak</span></code> is not,
<code class="docutils literal notranslate"><span class="pre">cp</span></code> reports an error.</p>
<p>Instead,
let’s use a loop to copy files to the backup directory
and append the <code class="docutils literal notranslate"><span class="pre">.bak</span></code> suffix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>data
$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>*e.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>cp<span class="w"> </span><span class="nv">$filename</span><span class="w"> </span>../backup/<span class="nv">$filename</span>.bak
&gt;<span class="w"> </span><span class="k">done</span>
$<span class="w"> </span>ls<span class="w"> </span>../backup
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>jane_eyre.txt.bak  time_machine.txt.bak
</pre></div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>The shell’s greatest strength is the way it combines a few powerful ideas with pipes and loops.
The next chapter will show how we can make our work more reproducible
by saving commands in files that we can run over and over again.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p>The exercises below involve creating and moving new files,
as well as considering hypothetical files.
Please note that if you create or move any files or directories in your Zipf’s Law project,
you may want to reorganize your files following the outline at the beginning of the next chapter.
If you accidentally delete necessary files,
you can start with a fresh copy of the data files
by following the instructions in Section <a class="reference external" href="https://software-engineering-group-up.github.io/RSE-UP/chapters/getting_started#downloading-the-data">Downloading the Data</a>.</p>
<section id="what-does-mean">
<h3>What does <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> mean?<a class="headerlink" href="#what-does-mean" title="Permalink to this heading">#</a></h3>
<p>We have seen the use of <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, but there is a similar operator <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> which works slightly differently.
We’ll learn about the differences between these two operators by printing some strings. We can use the <code class="docutils literal notranslate"><span class="pre">echo</span></code> command to print strings as shown below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>The<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>prints<span class="w"> </span>text
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>The echo command prints text
</pre></div>
</div>
<p>Now test the commands below to reveal the difference between the two operators:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>hello<span class="w"> </span>&gt;<span class="w"> </span>testfile01.txt
</pre></div>
</div>
<p>and:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>hello<span class="w"> </span>&gt;&gt;<span class="w"> </span>testfile02.txt
</pre></div>
</div>
<p>Hint: Try executing each command twice in a row and then examining the output files.</p>
</section>
<section id="appending-data">
<h3>Appending data<a class="headerlink" href="#appending-data" title="Permalink to this heading">#</a></h3>
<p>Given the following commands,
what will be included in the file <code class="docutils literal notranslate"><span class="pre">extracted.txt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span><span class="w"> </span>dracula.txt<span class="w"> </span>&gt;<span class="w"> </span>extracted.txt
$<span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>dracula.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>extracted.txt
</pre></div>
</div>
<ol class="arabic simple">
<li><p>The first three lines of <code class="docutils literal notranslate"><span class="pre">dracula.txt</span></code></p></li>
<li><p>The last two lines of <code class="docutils literal notranslate"><span class="pre">dracula.txt</span></code></p></li>
<li><p>The first three lines and the last two lines of <code class="docutils literal notranslate"><span class="pre">dracula.txt</span></code></p></li>
<li><p>The second and third lines of <code class="docutils literal notranslate"><span class="pre">dracula.txt</span></code></p></li>
</ol>
</section>
<section id="piping-commands">
<h3>Piping commands<a class="headerlink" href="#piping-commands" title="Permalink to this heading">#</a></h3>
<p>In our current directory, we want to find the 3 files which have the least number of
lines. Which command listed below would work?</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">-l</span> <span class="pre">*</span> <span class="pre">&gt;</span> <span class="pre">sort</span> <span class="pre">-n</span> <span class="pre">&gt;</span> <span class="pre">head</span> <span class="pre">-n</span> <span class="pre">3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">-l</span> <span class="pre">*</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">-n</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-n</span> <span class="pre">1-3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">-l</span> <span class="pre">*</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-n</span> <span class="pre">3</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">-n</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">-l</span> <span class="pre">*</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">-n</span> <span class="pre">|</span> <span class="pre">head</span> <span class="pre">-n</span> <span class="pre">3</span></code></p></li>
</ol>
</section>
<section id="why-does-uniq-only-remove-adjacent-duplicates">
<h3>Why does <code class="docutils literal notranslate"><span class="pre">uniq</span></code> only remove adjacent duplicates?<a class="headerlink" href="#why-does-uniq-only-remove-adjacent-duplicates" title="Permalink to this heading">#</a></h3>
<p>The command <code class="docutils literal notranslate"><span class="pre">uniq</span></code> removes adjacent duplicated lines from its input.
Consider a hypothetical file <code class="docutils literal notranslate"><span class="pre">genres.txt</span></code> containing the following data:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>science fiction
fantasy
science fiction
fantasy
science fiction
science fiction
</pre></div>
</div>
<p>Running the command <code class="docutils literal notranslate"><span class="pre">uniq</span> <span class="pre">genres.txt</span></code> produces:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>science fiction
fantasy
science fiction
fantasy
science fiction
</pre></div>
</div>
<p>Why do you think <code class="docutils literal notranslate"><span class="pre">uniq</span></code> only removes <em>adjacent</em> duplicated lines?
(Hint: think about very large datasets.) What other command could
you combine with it in a pipe to remove all duplicated lines?</p>
</section>
<section id="pipe-reading-comprehension">
<h3>Pipe reading comprehension<a class="headerlink" href="#pipe-reading-comprehension" title="Permalink to this heading">#</a></h3>
<p>A file called <code class="docutils literal notranslate"><span class="pre">titles.txt</span></code> contains a list of book titles and publication years:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Dracula,1897
Frankenstein,1818
Jane Eyre,1847
Moby Dick,1851
Sense and Sensibility,1811
The Adventures of Sherlock Holmes,1892
The Invisible Man,1897
The Time Machine,1895
Wuthering Heights,1847
</pre></div>
</div>
<p>What text passes through each of the pipes and the final redirect in the pipeline below?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>titles.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-r<span class="w"> </span>&gt;<span class="w"> </span>final.txt
</pre></div>
</div>
<p>Hint: build the pipeline up one command at a time to test your understanding</p>
</section>
<section id="pipe-construction">
<h3>Pipe construction<a class="headerlink" href="#pipe-construction" title="Permalink to this heading">#</a></h3>
<p>For the file <code class="docutils literal notranslate"><span class="pre">titles.txt</span></code> from the previous exercise, consider the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span>,<span class="w"> </span>-f<span class="w"> </span><span class="m">2</span><span class="w"> </span>titles.txt
</pre></div>
</div>
<p>What does the <code class="docutils literal notranslate"><span class="pre">cut</span></code> command (and its options) accomplish?</p>
</section>
<section id="which-pipe">
<h3>Which pipe?<a class="headerlink" href="#which-pipe" title="Permalink to this heading">#</a></h3>
<p>Consider the same <code class="docutils literal notranslate"><span class="pre">titles.txt</span></code> from the previous exercises.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">uniq</span></code> command has a <code class="docutils literal notranslate"><span class="pre">-c</span></code> option which gives a count of the
number of times a line occurs in its input.
If <code class="docutils literal notranslate"><span class="pre">titles.txt</span></code> was in your working directory,
what command would you use to produce
a table that shows the total count of each publication year in the file?</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">titles.txt</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">-c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">-t,</span> <span class="pre">-k2,2</span> <span class="pre">titles.txt</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">-c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span> <span class="pre">-d,</span> <span class="pre">-f</span> <span class="pre">2</span> <span class="pre">titles.txt</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">-c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span> <span class="pre">-d,</span> <span class="pre">-f</span> <span class="pre">2</span> <span class="pre">titles.txt</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">-c</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span> <span class="pre">-d,</span> <span class="pre">-f</span> <span class="pre">2</span> <span class="pre">titles.txt</span> <span class="pre">|</span> <span class="pre">sort</span> <span class="pre">|</span> <span class="pre">uniq</span> <span class="pre">-c</span> <span class="pre">|</span> <span class="pre">wc</span> <span class="pre">-l</span></code></p></li>
</ol>
</section>
<section id="doing-a-dry-run">
<h3>Doing a dry run<a class="headerlink" href="#doing-a-dry-run" title="Permalink to this heading">#</a></h3>
<p>A loop is a way to do many things at once—or to make many mistakes at
once if it does the wrong thing. One way to check what a loop <em>would</em> do
is to <code class="docutils literal notranslate"><span class="pre">echo</span></code> the commands it would run instead of actually running them.</p>
<p>Suppose we want to preview the commands the following loop will execute
without actually running those commands
(<code class="docutils literal notranslate"><span class="pre">analyze</span></code> is a hypothetical command):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>analyze<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>&gt;<span class="w"> </span>analyzed-<span class="nv">$file</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>What is the difference between the two loops below,
and which one would we want to run?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span><span class="nb">echo</span><span class="w"> </span>analyze<span class="w"> </span><span class="nv">$file</span><span class="w"> </span>&gt;<span class="w"> </span>analyzed-<span class="nv">$file</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;analyze </span><span class="nv">$file</span><span class="s2"> &gt; analyzed-</span><span class="nv">$file</span><span class="s2">&quot;</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
</section>
<section id="variables-in-loops">
<h3>Variables in loops<a class="headerlink" href="#variables-in-loops" title="Permalink to this heading">#</a></h3>
<p>Given the files in <code class="docutils literal notranslate"><span class="pre">data/</span></code>,
what is the output of the following code?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>datafile<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">    </span>ls<span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Now, what is the output of the following code?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>datafile<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">	</span>ls<span class="w"> </span><span class="nv">$datafile</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Why do these two loops give different outputs?</p>
</section>
<section id="limiting-sets-of-files">
<h3>Limiting sets of files<a class="headerlink" href="#limiting-sets-of-files" title="Permalink to this heading">#</a></h3>
<p>What would be the output of running the following loop in your <code class="docutils literal notranslate"><span class="pre">data/</span></code> directory?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>d*
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">    </span>ls<span class="w"> </span><span class="nv">$filename</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>How would the output differ from using this command instead?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>*d*
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">    </span>ls<span class="w"> </span><span class="nv">$filename</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
</section>
<section id="saving-to-a-file-in-a-loop">
<h3>Saving to a file in a loop<a class="headerlink" href="#saving-to-a-file-in-a-loop" title="Permalink to this heading">#</a></h3>
<p>Consider running the following loop in the  <code class="docutils literal notranslate"><span class="pre">data/</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>book<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">     </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$book</span>
&gt;<span class="w">     </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="nv">$book</span><span class="w"> </span>&gt;<span class="w"> </span>headers.txt
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Why would the following loop be preferable?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>book<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">     </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="nv">$book</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>headers.txt
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>\newpage</p>
</section>
<section id="why-does-history-record-commands-before-running-them">
<h3>Why does <code class="docutils literal notranslate"><span class="pre">history</span></code> record commands before running them?<a class="headerlink" href="#why-does-history-record-commands-before-running-them" title="Permalink to this heading">#</a></h3>
<p>If you run the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">history</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span>&gt;<span class="w"> </span>recent.sh
</pre></div>
</div>
<p>the last command in the file is the <code class="docutils literal notranslate"><span class="pre">history</span></code> command itself, i.e.,
the shell has added <code class="docutils literal notranslate"><span class="pre">history</span></code> to the command log before actually
running it. In fact, the shell <em>always</em> adds commands to the log
before running them. Why do you think it does this?</p>
</section>
</section>
<section id="key-points">
<h2>Key Points<a class="headerlink" href="#key-points" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Building Tools with the Unix Shell<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p>Wisdom comes from experience. Experience is often a result of lack of wisdom.</p>
<p>— Terry Pratchett\index{Pratchett, Terry}</p>
</div></blockquote>
<p>The shell’s greatest strength is that
it lets us combine programs to create pipelines
that can handle large volumes of data.
This lesson shows how to do that,
and how to repeat commands to process as many files as we want automatically.</p>
<p>We’ll be continuing to work in the <code class="docutils literal notranslate"><span class="pre">zipf</span></code> project,
which should contain the following files after the previous chapter:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>zipf/
└── data
    ├── README.md
    ├── dracula.txt
    ├── frankenstein.txt
    ├── jane_eyre.txt
    ├── moby_dick.txt
    ├── sense_and_sensibility.txt
    ├── sherlock_holmes.txt
    └── time_machine.txt
</pre></div>
</div>
<section id="id2">
<h2>Combining Commands<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>To see how the shell lets us combine commands,
let’s go into the <code class="docutils literal notranslate"><span class="pre">zipf/data</span></code> directory
and count the number of lines in each file once again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/zipf/data
$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  15975 dracula.txt
   7832 frankenstein.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
   3582 time_machine.txt
  96855 total
</pre></div>
</div>
<p>Which of these books is shortest?
We can check by eye when there are only seven files,
but what if there were eight thousand?</p>
<p>Our first step toward a solution is to run this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span>&gt;<span class="w"> </span>lengths.txt
</pre></div>
</div>
<p>The greater-than symbol <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> tells the shell
to <strong>redirect</strong> the command’s output to a file instead of printing it.
Nothing appears on the screen; instead,
everything that would have appeared has gone into the file <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code>.
The shell creates this file if it doesn’t exist,
or overwrites it if it already exists.</p>
<p>We can print the contents of <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code> using <code class="docutils literal notranslate"><span class="pre">cat</span></code>, which is short for con<strong>cat</strong>enate (because if we give it the names of several files
it will print them all in order):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>lengths.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  15975 dracula.txt
   7832 frankenstein.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
   3582 time_machine.txt
  96855 total
</pre></div>
</div>
<p>We can now use <code class="docutils literal notranslate"><span class="pre">sort</span></code> to sort the lines in this file:</p>
<p>\newpage</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span>lengths.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
  15975 dracula.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  96855 total
</pre></div>
</div>
<p>Just to be safe,
we use <code class="docutils literal notranslate"><span class="pre">sort</span></code>’s <code class="docutils literal notranslate"><span class="pre">-n</span></code> option to specify that we want to sort numerically.
Without it,
<code class="docutils literal notranslate"><span class="pre">sort</span></code> would order things alphabetically
so that <code class="docutils literal notranslate"><span class="pre">10</span></code> would come before <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">sort</span></code> does not change <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code>.
Instead,
it sends its output to the screen just as <code class="docutils literal notranslate"><span class="pre">wc</span></code> did.
We can therefore put the sorted list of lines in another temporary file called <code class="docutils literal notranslate"><span class="pre">sorted-lengths.txt</span></code>
using <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> once again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span>lengths.txt<span class="w"> </span>&gt;<span class="w"> </span>sorted-lengths.txt
</pre></div>
</div>
<blockquote>
<div><p><strong>Redirecting to the Same File</strong></p>
<p>It’s tempting to send the output of <code class="docutils literal notranslate"><span class="pre">sort</span></code> back to the file it reads:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span>lengths.txt<span class="w"> </span>&gt;<span class="w"> </span>lengths.txt
</pre></div>
</div>
<p>However, all this does is wipe out the contents of <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code>.
The reason is that when the shell sees the redirection,
it opens the file on the right of the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> for writing,
which erases anything that file contained.
It then runs <code class="docutils literal notranslate"><span class="pre">sort</span></code>, which finds itself reading from a newly empty file.</p>
</div></blockquote>
<p>Creating intermediate files with names like <code class="docutils literal notranslate"><span class="pre">lengths.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">sorted-lengths.txt</span></code> works,
but keeping track of those files and cleaning them up when they’re no longer needed is a burden.
Let’s delete the two files we just created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>lengths.txt<span class="w"> </span>sorted-lengths.txt
</pre></div>
</div>
<p>We can produce the same result more safely and with less typing
using a <strong>pipe</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
  13053 sherlock_holmes.txt
  15975 dracula.txt
  21054 jane_eyre.txt
  22331 moby_dick.txt
  96855 total
</pre></div>
</div>
<p>The vertical bar <code class="docutils literal notranslate"><span class="pre">|</span></code> between the <code class="docutils literal notranslate"><span class="pre">wc</span></code> and <code class="docutils literal notranslate"><span class="pre">sort</span></code> commands
tells the shell that we want to use the output of the command on the left
as the input to the command on the right.</p>
<p>Running a command with a file as input has a clear flow of information:
the command performs a task on that file and prints the output to the screen
(<span class="xref myst"></span> a).
When using pipes, however,
the information flows differently after the first (upstream) command.
The downstream command doesn’t read from a file.
Instead,
it reads the output of the upstream command
(<a class="reference internal" href="#bash-tools-pipe"><span class="std std-ref">Bash tools pip</span></a> b).</p>
<figure class="align-default" id="bash-tools-pipe">
<img alt="../_images/pipe.png" src="../_images/pipe.png" />
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Bash tools pip</span><a class="headerlink" href="#bash-tools-pipe" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We can use <code class="docutils literal notranslate"><span class="pre">|</span></code> to build pipes of any length.
For example,
we can use the command <code class="docutils literal notranslate"><span class="pre">head</span></code> to get just the first three lines of sorted data,which shows us the three shortest books:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
</pre></div>
</div>
<blockquote>
<div><p><strong>Options Can Have Values</strong></p>
<p>When we write <code class="docutils literal notranslate"><span class="pre">head</span> <span class="pre">-n</span> <span class="pre">3</span></code>,
the value 3 is not input to <code class="docutils literal notranslate"><span class="pre">head</span></code>.
Instead, it is associated with the option <code class="docutils literal notranslate"><span class="pre">-n</span></code>.
Many options take values like this,
such as the names of input files or the background color to use in a plot.
Some versions of <code class="docutils literal notranslate"><span class="pre">head</span></code> may allow you to use <code class="docutils literal notranslate"><span class="pre">head</span> <span class="pre">-3</span></code> as a shortcut,
though this can be confusing if other options are included.</p>
</div></blockquote>
<p>We could always redirect the output to a file
by adding <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">shortest.txt</span></code> to the end of the pipeline,
thereby retaining our answer for later reference.</p>
<p>In practice,
most Unix users would create this pipeline step by step,
just as we have:
by starting with a single command and adding others one by one,
checking the output after each change.
The shell makes this easy
by letting us move up and down in our <strong>command history</strong>
with the <kbd>↑</kbd> and <kbd>↓</kbd> keys.
We can also edit old commands to create new ones,
so a very common sequence is:</p>
<ul class="simple">
<li><p>Run a command and check its output.</p></li>
<li><p>Use <kbd>↑</kbd> to bring it up again.</p></li>
<li><p>Add the pipe symbol <code class="docutils literal notranslate"><span class="pre">|</span></code> and another command to the end of the line.</p></li>
<li><p>Run the pipe and check its output.</p></li>
<li><p>Use <kbd>↑</kbd> to bring it up again.</p></li>
<li><p>And so on.</p></li>
</ul>
</section>
<section id="id3">
<h2>How Pipes Work<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>In order to use pipes and redirection effectively,
we need to know a little about how they work.
When a computer runs a program—any program—it creates a <strong>process</strong>
to hold the program’s instructions and data.
Every process in Unix has an input channel called <strong>standard input</strong> and an output channel called <strong>standard output</strong>.
(By now you may be surprised that their names are so memorable,
but don’t worry: most Unix programmers call them “stdin” and “stdout”,
which are pronounced “stuh-Din” and “stuh-Dout”).</p>
<p>The shell is a program like any other,
and like any other, it runs inside a process.
Under normal circumstances its standard input is connected to our keyboard
and its standard output to our screen,
so it reads what we type
and displays its output for us to see ()<a class="reference internal" href="#bash-tools-stdio-2"><span class="std std-ref">Bash Tools stdio</span></a> a).
When we tell the shell to run a program,
it creates a new process
and temporarily reconnects the keyboard and stream
to that process’s standard input and output (<a class="reference internal" href="#bash-tools-stdio-2"><span class="std std-ref">Bash Tools stdio</span></a> b).</p>
<figure class="align-default" id="bash-tools-stdio-2">
<img alt="../_images/standard-io.png" src="../_images/standard-io.png" />
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Bash Tools stdio</span><a class="headerlink" href="#bash-tools-stdio-2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If we provide one or more files for the command to read,
as with <code class="docutils literal notranslate"><span class="pre">sort</span> <span class="pre">lengths.txt</span></code>, the program reads data from those files.
If we don’t provide any filenames, though,
the Unix convention is for the program to read from standard input.
We can test this by running <code class="docutils literal notranslate"><span class="pre">sort</span></code> on its own,
typing in a few lines of text,
and then pressing <kbd>Ctrl</kbd>+<kbd>D</kbd> to signal the end of input .
<code class="docutils literal notranslate"><span class="pre">sort</span></code> will then sort and print whatever we typed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sort
one
two
three
four
^D
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>four
one
three
two
</pre></div>
</div>
<p>Redirection with <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> tells the shell to connect the program’s standard output to a file
instead of the screen (<a class="reference internal" href="#bash-tools-stdio-2"><span class="std std-ref">Bash Tools stdio</span></a>c).</p>
<p>When we create a pipe like <code class="docutils literal notranslate"><span class="pre">wc</span> <span class="pre">*.txt</span> <span class="pre">|</span> <span class="pre">sort</span></code>,
the shell creates one process for each command so that <code class="docutils literal notranslate"><span class="pre">wc</span></code> and <code class="docutils literal notranslate"><span class="pre">sort</span></code> will run simultaneously,
and then connects the standard output of <code class="docutils literal notranslate"><span class="pre">wc</span></code> directly to the standard input of <code class="docutils literal notranslate"><span class="pre">sort</span></code>
(<span class="xref myst"></span>d).</p>
<p><code class="docutils literal notranslate"><span class="pre">wc</span></code> doesn’t know whether its output is going to the screen,
another program, or to a file via <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>.
Equally, <code class="docutils literal notranslate"><span class="pre">sort</span></code> doesn’t know if its input is coming from the keyboard or another process; it just knows that it has to read, sort, and print.</p>
<blockquote>
<div><p><strong>Why Isn’t It Doing Anything?</strong></p>
<p>What happens if a command is supposed to process a file
but we don’t give it a filename?
For example, what if we type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l
</pre></div>
</div>
<p>but don’t type <code class="docutils literal notranslate"><span class="pre">*.txt</span></code> (or anything else) after the command?
Since <code class="docutils literal notranslate"><span class="pre">wc</span></code> doesn’t have any filenames,
it assumes it is supposed to read from the keyboard,
so it waits for us to type in some data.
It doesn’t tell us this;
it just sits and waits.</p>
<p>This mistake can be hard to spot,
particularly if we put the filename at the end of the pipeline:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>moby_dick.txt
</pre></div>
</div>
<p>In this case,
<code class="docutils literal notranslate"><span class="pre">sort</span></code> ignores standard input and reads the data in the file,
but <code class="docutils literal notranslate"><span class="pre">wc</span></code> still just sits there waiting for input.</p>
<p>If we make this mistake,
we can end the program by typing <kbd>Ctrl</kbd>+<kbd>C</kbd>.
We can also use this to interrupt programs that are taking a long time to run
or are trying to connect to a website that isn’t responding.</p>
</div></blockquote>
<p>\newpage</p>
<p>Just as we can redirect standard output with <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>,
we can connect standard input to a file using <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>.In the case of a single file,
this has the same effect as providing the file’s name to the <code class="docutils literal notranslate"><span class="pre">wc</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>&lt;<span class="w"> </span>moby_dick.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>    22331  215832 1276222
</pre></div>
</div>
<p>If we try to use redirection with a wildcard,
though,
the shell <em>doesn’t</em> concatenate all of the matching files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>&lt;<span class="w"> </span>*.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-bash: *.txt: ambiguous redirect
</pre></div>
</div>
<p>It also doesn’t print the error message to standard output,
which we can prove by redirecting:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>wc<span class="w"> </span>&lt;<span class="w"> </span>*.txt<span class="w"> </span>&gt;<span class="w"> </span>all.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-bash: *.txt: ambiguous redirect
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>all.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cat: all.txt: No such file or directory
</pre></div>
</div>
<p>Instead,
every process has a second output channel called <strong>standard error</strong>.
Programs use it for error messages so that their attempts to tell us something has gone wrong don’t vanish silently into an output file.
There are ways to redirect standard error, but doing so is almost always a bad idea.</p>
</section>
<section id="id4">
<h2>Repeating Commands on Many Files<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>A loop is a way to repeat a set of commands for each item in a list. We can use them to build complex workflows out of simple pieces, and (like wildcards)
they reduce the typing we have to do and the number of mistakes we might make.</p>
<p>Let’s suppose that we want to take a section out of each book
whose name starts with the letter “s” in the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory.
More specifically, suppose we want to get the first 8 lines of each book
<em>after</em> the 9 lines of license information that appear at the start of the file.
If we only cared about one file, we could write a pipeline to take the first 17 lines and then take the last 8 of those:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span>sense_and_sensibility.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English
</pre></div>
</div>
<p>If we try to use a wildcard to select files,
we only get 8 lines of output,
not the 16 we expect:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w">  </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span>s*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
<p>The problem is that <code class="docutils literal notranslate"><span class="pre">head</span></code> is producing a single stream of output
containing 17 lines for each file
(along with a header telling us the file’s name):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span>s*.txt
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>==&gt; sense_and_sensibility.txt &lt;==
The Project Gutenberg EBook of Sense and Sensibility, by ...

This eBook is for the use of anyone anywhere at no cost and with
almost no restrictions whatsoever.  You may copy it, give it ...
re-use it under the terms of the Project Gutenberg License ...
with this eBook or online at www.gutenberg.net



Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English

==&gt; sherlock_holmes.txt &lt;==
Project Gutenberg&#39;s The Adventures of Sherlock Holmes, by Arthur
Conan Doyle

This eBook is for the use of anyone anywhere at no cost and ...
almost no restrictions whatsoever.  You may copy it, give ...
re-use it under the terms of the Project Gutenberg License ...
with this eBook or online at www.gutenberg.net



Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
<p>\newpage</p>
<p>Let’s try this instead:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>sense_and_sensibility.txt<span class="w"> </span>sherlock_holmes.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English
Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
<p>As the output shows,
the loop runs our pipeline once for each file.
There is a lot going on here,
so we will break it down into pieces:</p>
<ol class="arabic simple">
<li><p>The keywords <code class="docutils literal notranslate"><span class="pre">for</span></code>, <code class="docutils literal notranslate"><span class="pre">in</span></code>, <code class="docutils literal notranslate"><span class="pre">do</span></code>, and <code class="docutils literal notranslate"><span class="pre">done</span></code> create the loop,
and must always appear in that order.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code> is a variable just like a variable in Python.
At any moment it contains a value,
but that value can change over time.</p></li>
<li><p>The loop runs once for each item in the list.
Each time it runs,
it assigns the next item to the variable.
In this case, <code class="docutils literal notranslate"><span class="pre">filename</span></code> will be <code class="docutils literal notranslate"><span class="pre">sense_and_sensibility.txt</span></code>
the first time around the loop
and <code class="docutils literal notranslate"><span class="pre">sherlock_holmes.txt</span></code> the second time.</p></li>
<li><p>The commands that the loop executes are called the <strong>body</strong> and appear between the keywords <code class="docutils literal notranslate"><span class="pre">do</span></code> and <code class="docutils literal notranslate"><span class="pre">done</span></code>.
Those commands use the current value of the variable <code class="docutils literal notranslate"><span class="pre">filename</span></code>,
but to get it, we must put a dollar sign <code class="docutils literal notranslate"><span class="pre">$</span></code> in front of the variable’s name.
If we forget and use <code class="docutils literal notranslate"><span class="pre">filename</span></code> instead of <code class="docutils literal notranslate"><span class="pre">$filename</span></code>,
the shell will think that we are referring to a file
that is actually called <code class="docutils literal notranslate"><span class="pre">filename</span></code>.</p></li>
<li><p>The shell prompt changes from <code class="docutils literal notranslate"><span class="pre">$</span></code>
to a <strong>continuation prompt</strong> <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>
as we type in our loop to remind us that we haven’t finished typing a complete command yet.
We don’t type the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>,
just as we don’t type the <code class="docutils literal notranslate"><span class="pre">$</span></code>.
The continuation prompt <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> has nothing to do with redirection;
it’s used because there are only so many punctuation symbols available.</p></li>
</ol>
<blockquote>
<div><p><strong>Continuation Prompts May Differ Too</strong></p>
<p>As mentioned in Chapter <a class="reference external" href="https://software-engineering-group-up.github.io/RSE-UP/chapters/bash_basics.html"> Bash Basics</a>,
there is variation in how different shells look and operate.
If you noticed the second, third, and fourth code lines
in your for loop were prefaced with <code class="docutils literal notranslate"><span class="pre">for</span></code>,
it’s not because you did something wrong!
That difference is one of the ways in which <code class="docutils literal notranslate"><span class="pre">zsh</span></code> differs from <code class="docutils literal notranslate"><span class="pre">bash</span></code>.</p>
</div></blockquote>
<p>It is very common to use a wildcard to select a set of files
and then loop over that set to run commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Title: Sense and Sensibility

Author: Jane Austen
Editor:
Release Date: May 25, 2008 [EBook #161]
Posting Date:
Last updated: February 11, 2015
Language: English



Title: The Adventures of Sherlock Holmes

Author: Arthur Conan Doyle
Editor:
Release Date: April 18, 2011 [EBook #1661]
Posting Date: November 29, 2002
Latest Update:
Language: English
</pre></div>
</div>
</section>
<section id="id5">
<h2>Variable Names<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<p>We should always choose meaningful names for variables,
but we should remember that those names don’t mean anything to the computer.
For example,
we have called our loop variable <code class="docutils literal notranslate"><span class="pre">filename</span></code>
to make its purpose clear to human readers,
but we could equally well write our loop as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>x<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$x</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>or as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>username<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$username</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p><em>Don’t do this.</em>
Programs are only useful if people can understand them,
so meaningless names like <code class="docutils literal notranslate"><span class="pre">x</span></code> and misleading names like <code class="docutils literal notranslate"><span class="pre">username</span></code>
increase the odds of misunderstanding.</p>
</section>
<section id="id6">
<h2>Redoing Things<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>Loops are useful if we know in advance what we want to repeat,
but we can also repeat commands that we have run recently.
One way is to use <kbd>↑</kbd> and <kbd>↓</kbd>
to go up and down in our command history as described earlier.
Another is to use <code class="docutils literal notranslate"><span class="pre">history</span></code> to get a list of the last few hundred commands we have run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">history</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  551  wc -l *.txt | sort -n
  552  wc -l *.txt | sort -n | head -n 3
  553  wc -l *.txt | sort -n | head -n 1 &gt; shortest.txt
</pre></div>
</div>
<p>We can use an exclamation mark <code class="docutils literal notranslate"><span class="pre">!</span></code> followed by a number
to repeat a recent command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>!552
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wc<span class="w"> </span>-l<span class="w"> </span>*.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>   3582 time_machine.txt
   7832 frankenstein.txt
  13028 sense_and_sensibility.txt
</pre></div>
</div>
<p>The shell prints the command it is going to re-run to standard error
before executing it,
so that (for example) <code class="docutils literal notranslate"><span class="pre">!572 &gt; results.txt</span></code>
puts the command’s output in a file
<em>without</em> also writing the command to the file.</p>
<p>Having an accurate record of the things we have done
and a simple way to repeat them
are two of the main reasons people use the Unix shell.
In fact,
being able to repeat history is such a powerful idea
that the shell gives us several ways to do it:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">!head</span></code> re-runs the most recent command starting with <code class="docutils literal notranslate"><span class="pre">head</span></code>,
while <code class="docutils literal notranslate"><span class="pre">!wc</span></code> re-runs the most recent starting with <code class="docutils literal notranslate"><span class="pre">wc</span></code>.</p></li>
<li><p>If we type <kbd>Ctrl</kbd>+<kbd>R</kbd> (for <strong>r</strong>everse search)
the shell searches backward through its history for whatever we type next.
If we don’t like the first thing it finds,
we can type <kbd>Ctrl</kbd>+<kbd>R</kbd> again to go further back.</p></li>
</ul>
<p>If we use <code class="docutils literal notranslate"><span class="pre">history</span></code>, <kbd>↑</kbd>, or <kbd>Ctrl</kbd>+<kbd>R</kbd>
we will quickly notice that loops don’t have to be broken across lines.
Instead,
their parts can be separated with semi-colons:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="p">;</span>
<span class="k">done</span>
</pre></div>
</div>
<p>This is fairly readable,
though it becomes more challenging if our for loop includes multiple commands.
For example,
we may choose to include the <code class="docutils literal notranslate"><span class="pre">echo</span></code> command,
which prints its arguments to the screen,
so we can keep track of progress or for debugging.
Compare this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$filename</span>
&gt;<span class="w">   </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span>
&gt;<span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>with this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>s*.txt<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$filename</span><span class="p">;</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="nv">$filename</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<p>Even experienced users have a tendency to (incorrectly)
put the semi-colon after <code class="docutils literal notranslate"><span class="pre">do</span></code> instead of before it.
If our loop contains multiple commands,
though,
the multi-line format is much easier to read and troubleshoot.
Note that (depending on the size of your shell window)
the format separated by semi-colons may be printed onto more than one line,
as shown in the previous code example.
You can tell whether code entered into your shell
is intended to be run as a single line based on the prompt:
both the original command prompt (<code class="docutils literal notranslate"><span class="pre">$</span></code>) and the continuation prompt (<code class="docutils literal notranslate"><span class="pre">&gt;</span></code>)
indicate the code is on separate lines;
the absence of either in shell commands indicates it is a single line of code.</p>
</section>
<section id="id7">
<h2>Creating New Filenames Automatically<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<p>Suppose we want to create a backup copy of each book whose name ends in “e”.
If we don’t want to change the files’ names,
we can do this with <code class="docutils literal notranslate"><span class="pre">cp</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/zipf
$<span class="w"> </span>mkdir<span class="w"> </span>backup
$<span class="w"> </span>cp<span class="w"> </span>data/*e.txt<span class="w"> </span>backup
$<span class="w"> </span>ls<span class="w"> </span>backup
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>jane_eyre.txt  time_machine.txt
</pre></div>
</div>
<blockquote>
<div><p><strong>Warnings</strong></p>
<p>If you attempt to re-execute the code chunk above,
you’ll end up with an error after the second line:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mkdir: backup: File exists
</pre></div>
</div>
<p>This warning isn’t necessarily a cause for alarm.
It lets you know that the command couldn’t be completed,
but will not prevent you from proceeding.</p>
</div></blockquote>
<p>But what if we want to append the extension <code class="docutils literal notranslate"><span class="pre">.bak</span></code> to the files’ names?
<code class="docutils literal notranslate"><span class="pre">cp</span></code> can do this for a single file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>data/time_machine.txt<span class="w"> </span>backup/time_machine.txt.bak
</pre></div>
</div>
<p>but not for all the files at once:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>data/*e.txt<span class="w"> </span>backup/*e.txt.bak
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cp: target &#39;backup/*e.txt.bak&#39; is not a directory
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">backup/*e.txt.bak</span></code> doesn’t match anything—those files don’t yet exist—so
after the shell expands the <code class="docutils literal notranslate"><span class="pre">*</span></code> wildcards,
what we are actually asking <code class="docutils literal notranslate"><span class="pre">cp</span></code> to do is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cp<span class="w"> </span>data/jane_eyre.txt<span class="w"> </span>data/time_machine.txt<span class="w"> </span>backup/*e.bak
</pre></div>
</div>
<p>This doesn’t work because <code class="docutils literal notranslate"><span class="pre">cp</span></code> only understands how to do two things:
copy a single file to create another file, or copy a bunch of files into a directory. If we give it more than two names as arguments, it expects the last one to be a directory. Since <code class="docutils literal notranslate"><span class="pre">backup/*e.bak</span></code> is not, <code class="docutils literal notranslate"><span class="pre">cp</span></code> reports an error.</p>
<p>Instead, let’s use a loop to copy files to the backup directory
and append the <code class="docutils literal notranslate"><span class="pre">.bak</span></code> suffix:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>data
$<span class="w"> </span><span class="k">for</span><span class="w"> </span>filename<span class="w"> </span><span class="k">in</span><span class="w"> </span>*e.txt
&gt;<span class="w"> </span><span class="k">do</span>
&gt;<span class="w">   </span>cp<span class="w"> </span><span class="nv">$filename</span><span class="w"> </span>../backup/<span class="nv">$filename</span>.bak
&gt;<span class="w"> </span><span class="k">done</span>
$<span class="w"> </span>ls<span class="w"> </span>../backup
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>jane_eyre.txt.bak  time_machine.txt.bak
</pre></div>
</div>
</section>
<section id="id8">
<h2>Summary<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h2>
<p>The shell’s greatest strength is the way it combines a few powerful ideas with pipes and loops.
The next chapter will show how we can make our work more reproducible
by saving commands in files that we can run over and over again.</p>
</section>
<section id="id9">
<h2>Key Points<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cat</span></code> displays the contents of its inputs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">head</span></code> displays the first few lines of its input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tail</span></code> displays the last few lines of its input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sort</span></code> sorts its inputs.</p></li>
<li><p>Use the up-arrow key to scroll up through previous commands to edit and repeat them.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">history</span></code> to display recent commands and <code class="docutils literal notranslate"><span class="pre">!number</span></code> to repeat a command by number.</p></li>
<li><p>Every process in Unix has an input channel called <strong>standard input</strong> / <strong>stdin</strong>
and an output channel called <strong>standard output</strong> / <strong>stdout</strong>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;</span></code> redirects a command’s output to a file, overwriting any existing content.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> appends a command’s output to a file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code> operator redirects input to a command.</p></li>
<li><p>A <strong>pipe</strong> <code class="docutils literal notranslate"><span class="pre">|</span></code> sends the output of the command on the left to the input of the command on the right.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">for</span></code> loop repeats commands once for every thing in a list.</p></li>
<li><p>Every <code class="docutils literal notranslate"><span class="pre">for</span></code> loop  must have a variable to refer to the thing it is currently operating on
and a <strong>body</strong> containing commands to execute.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">$name</span></code> or <code class="docutils literal notranslate"><span class="pre">${name}</span></code> to get the value of a variable.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="bash_basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">The Basics of the Unix Shell</p>
      </div>
    </a>
    <a class="right-next"
       href="bash_advanced.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Going Further with the Unix Shell</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Building Tools with the Unix Shell</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-commands">Combining Commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-pipes-work">How Pipes Work</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repeating-commands-on-many-files">Repeating Commands on Many Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variable-names">Variable Names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redoing-things">Redoing Things</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-new-filenames-automatically">Creating New Filenames Automatically</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-does-mean">What does <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> mean?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#appending-data">Appending data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#piping-commands">Piping commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-uniq-only-remove-adjacent-duplicates">Why does <code class="docutils literal notranslate"><span class="pre">uniq</span></code> only remove adjacent duplicates?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipe-reading-comprehension">Pipe reading comprehension</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipe-construction">Pipe construction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#which-pipe">Which pipe?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#doing-a-dry-run">Doing a dry run</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variables-in-loops">Variables in loops</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#limiting-sets-of-files">Limiting sets of files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-to-a-file-in-a-loop">Saving to a file in a loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-does-history-record-commands-before-running-them">Why does <code class="docutils literal notranslate"><span class="pre">history</span></code> record commands before running them?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-points">Key Points</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Building Tools with the Unix Shell</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Combining Commands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">How Pipes Work</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Repeating Commands on Many Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Variable Names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Redoing Things</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Creating New Filenames Automatically</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Key Points</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Software Engineering Group - University of Potsdam
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>